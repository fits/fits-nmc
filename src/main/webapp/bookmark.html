<!DOCTYPE html>
<html>
<head>
  <title>New Music</title>
  <style type="text/css" media="screen">@import "js/jqtouch/jqtouch.min.css";</style>
  <style type="text/css" media="screen">@import "js/themes/apple/theme.min.css";</style>
  <style type="text/css">
    .row {
      background: rgb(240, 240, 240);
    }
    .row > .title {
      margin-left: 10px;
    }
    ul {
      font-size: 12px;
    }
    .schedule {
      padding-top: 5px;
      padding-left: 20px;
    }
  </style>
  <script src="js/jqtouch/jquery.1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/jqtouch/jqtouch.min.js" type="application/x-javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
    $.jQTouch({
    });

    $(function() {
      var url = "service/bookmark";

      $("#bookmark_list").empty();

      $.get(url, null, function(res){
        if (res["error"]) {
          window.location.href = res["error"];
        }
        else {
          var list = [];

          $.each(res, function() {
            $("#bookmark_list").append("<li><div>" + this.title + " : " + this.artist + "</div><div class='schedule' id='" + this.id  + "'></div></li>");
            
            list.push(this.id)
          });
          
          updateSchedule(list);
        }
      }, "json");
    });

    function updateSchedule(idList) {
      window.setTimeout(function() {
        for (var i = 0; i < idList.length; i++) {
          var id = idList[i];
          var url = "service/schedule/" + id;

          $.get(url, null, function(res){
            $.each(res, function() {
              $("#" + id).append(this.date + " : " + this.title + "<br />");
            });
          }, "json");
        }
      }, 100);
    }

  </script>
</head>
<body>
  <div id="bookmark" class="current">
    <div class="toolbar">
      <h1 id="pageTitle">Bookmark</h1>
      <a class="button leftButton" href="index.html">NewMusic</a>
    </div>
    <ul id="bookmark_list" class="rounded"></ul>
  </div>
</body>
</html>
