<!DOCTYPE html>
<html>
<head>
  <title>New Music</title>
  <style type="text/css" media="screen">@import "js/jqtouch/jqtouch.min.css";</style>
  <style type="text/css" media="screen">@import "js/themes/apple/theme.min.css";</style>
  <style type="text/css">
    .row {
      background: rgb(240, 240, 240);
    }
    .row > .title {
      margin-left: 10px;
    }
    ul {
      font-size: 12px;
    }
  </style>
  <script src="js/jqtouch/jquery.1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="js/jqtouch/jqtouch.min.js" type="application/x-javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">
    $.jQTouch({
    });

    $(function() {
      $("#music_list").empty();

      $.get("service/list", null, function(res){
        $.each(res, function() {
          var id = this.id;

          var content = "<div id='" + id + "'>";
          content += createToolbar(this.title, this.artist, "Back");
          content += "<ul id='" + id + "_list'></ul>";
          content += "</div>";
          $(document.body).append(content);

          $("#music_list").append("<li class='arrow'><a id='" + id + "_link' href='#" + id + "'>" + this.title + " : " + this.artist + "</a></li>");

          addMusicClickListener(id);
        });
      }, "json");
    });

    /**
     * 曲をクリックした際のイベント処理を設定する
     */
    function addMusicClickListener(id) {
      $("#" + id + "_link").click(function(e) {
        $("#" + id + "_list").empty();

        $.get("service/schedule/" + id, null, function(res2){
          var html = "";

          $.each(res2, function() {
            html += "<li class='row'>";
            html += "<label>" + this.date + "</label>";
            html += "<label class='title'>" + this.title + "</label>";
            html += "</li>";
          });

          if (html == "") {
            html += "<li class='row'>nothing</li>";
          }

          $("#" + id + "_list").append(html);
        }, "json");
      });
    }

    /**
     * Toolbar のタグを作成する
     */
    function createToolbar(title, artist, back) {
      var result = "<div class='toolbar'>";
      result += "<h1><small>" + title + "<br />" + artist + "</small></h1>";
      result += "<a class='button back' href='#" + back + "'>" + back + "</a>";
      result += "</div>";
      return result;
    }

  </script>
</head>
<body>
  <div id="music" class="current">
    <div class="toolbar">
      <h1 id="pageTitle">New Music</h1>
    </div>
    <ul id="music_list" class="rounded"></ul>
  </div>
</body>
</html>
